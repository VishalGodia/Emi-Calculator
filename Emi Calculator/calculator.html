<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="loanCalwrapper elgCal">
    <div class="container-fluid">
        <div class="row align-items-center">

            <!-- Left Column -->
            <div class="col-md-12 col-lg-6">
                <h2>
                    <div id="emiHead">Experience our loans</div>
                    <p id="emiSubHead">crafted to enhance your life</p>
                </h2>

                <div class="proWrapper">
                    <div class="progress mx-auto" id="myValue" data-value="100" data-myprogress="100">
                        <span class="progess-left">
                            <span class="progress-bar border-primary"></span>
                        </span>
                        <span class="progess-right">
                            <span class="progess-bar border-primary"></span>
                        </span>
                        <div class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">
                            <div class="proCnt text-uppercase">
                                Monthly Payable Amount <span class="amt" id="elegibleLoanAmount">₹ 0</span>
                            </div>
                        </div>
                    </div>

                    <div class="proData" id="proData"></div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-md-12 col-lg-6">
                <div class="calcBox">

                    <div class="form-group mob-hide">
                        <label>Select Loan Type</label>
                        <div class="wrapper-dropdown mobWrapper-dropdown" id="dropdown">
                            <span class="sortText d-none">Sort by</span>
                            <span class="selected-display cal-select-text" id="destination">Personal Loan</span>
                            <svg class="arrow" id="drp-arrow2" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M7 14.5l5-5 5 5" stroke="currentColor" stroke-width="1.5"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <ul class="dropdown dropdownOptions" id="dropdownMenu">
                                <li class="item" value="Personal Loan">Personal Loan</li>
                                <li class="item" value="Business Loan">Business Loan</li>
                                <li class="item" value="Loan Against property">Loan Against Property</li>
                                <li class="item" value="Machinery Loan">Machinery Loan</li>
                                <li class="item" value="Other Loans">Other Loans</li>
                            </ul>
                        </div>
                    </div>

                    <h4 class="mt-4">Loan Amount</h4>
                    <div class="wrapper Range homeRange d-flex justify-content-between mt-3">
                        <div id="amountWords">One Lakh</div>
                        <div class="input-loan-amount">
                            <input class="text-right rngRgt" type="text" id="loanAmount1" value="₹ 1,00,000"
                                onkeyup="assignLoanAmount(this); pl_elgigibility_cal();"
                                style="display:block; border-radius: 0 8px 8px 0;">
                        </div>
                    </div>

                    <input type="range" id="loanAmount" step="1000" min="100000" max="6000000" value="100000"
                        onchange="showPrincipalAmount(); pl_elgigibility_cal();">

                    <div class="rangeData">
                        <div id="minLoanAmount">₹ 1,00,000</div>
                        <div id="maxLoanAmount">₹ 60,00,000</div>
                    </div>

                    <h4 class="mt-4">Interest Rate</h4>
                    <div class="wrapperRange homeRange">
                        <div class="input-rate">
                            <span class="text-right rngRgt pull-right" id="spanRate"
                                style="display: block; border-radius:0 8px 8px 0;">%</span>
                            <input type="text" class="text-right rngRgt pull-right" value="2.5" id="interestRate1"
                                pattern="^\d*(\.\d{0,2})?$" style="width:140px; border-radius: 8px 0 0 8px;"
                                onkeyup="assignInterest(this); pl_elgigibility_cal();">
                        </div>

                        <input type="range" id="interestRate" step="0.1" min="2" max="16"
                            onchange="showInterestRate(); pl_elgigibility_cal();">

                        <div class="rangeData">
                            <div id="minInterestRate">2 %</div>
                            <div id="maxInterestRate">16 %</div>
                        </div>
                    </div>

                    <h4 class="mt-4">Loan Tenure</h4>
                    <div class="wrapperRange homeRange">
                        <div class="input-month">
                            <span id="spanMonth" class="text-right rngRgt pull-right"
                                style="display: block; border-radius: 0 8px 8px 0;">Months</span>
                            <input class="text-right rngRgt pull-right" type="text" maxlength="2" id="tenure1"
                                value="12" onkeyup="assignTenure(this); pl_elgigibility_cal();"
                                style="width: 70px; border-radius: 8px 0 0 8px;">
                        </div>

                        <input type="range" id="tenure" step="1" min="12" max="84"
                            onchange="showTenure(); pl_elgigibility_cal();">

                        <div class="rangeData">
                            <div id="minTenure">12 Months</div>
                            <div id="maxTenure">84 Months</div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-center loanBtn mt-4">
                        <a href="#" id="applyLink">
                            <button class="btn btnWhite apply" id="applyButton" aria-label="Apply for Loan">
                                Apply Now
                            </button>
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function showTenure() {
        var tenure = $('#tenure').val();
        $('#tenure1').val(tenure);
        $('#spanMonth').css("display", "block");
    }

    function showPrincipalAmount() {
        var loanAmount = parseFloat($('#loanAmount').val());
        $('#loanAmount1').val(loanAmount.toLocaleString('en-IN'));
    }

    function showInterestRate() {
        var interestRate = parseFloat($('#interestRate').val());
        $('#interestRate1').val(interestRate.toLocaleString('en-IN'));
    }

    function assignTenure(input) {
        var value = input.value.replace(/[^\d]/g, '');
        $('#tenure').val(value);
        $('#tenure1').val(value);
    }

    function assignLoanAmount(input) {
        var value = input.value.replace(/[^\d]/g, '');
        var numericValue = parseFloat(value);
        var max = parseFloat($('#loanAmount').attr('max'));
        var min = parseFloat($('#loanAmount').attr('min'));

        if (numericValue > max) numericValue = max;
        if (numericValue < min) numericValue = min;

        $('#loanAmount').val(numericValue);
        $('#loanAmount1').val(numericValue.toLocaleString('en-IN'));
    }

    function assignInterest(input) {
        var value = input.value.replace(/[^\d.]/g, '');
        var numericValue = parseFloat(value);
        var max = parseFloat($('#interestRate').attr('max'));
        var min = parseFloat($('#interestRate').attr('min'));

        if (numericValue > max) numericValue = max;
        if (numericValue < min) numericValue = min;

        $('#interestRate').val(numericValue);
        $('#interestRate1').val(numericValue.toLocaleString('en-IN'));
    }

    $(document).ready(function () {
        $('#dropdownMenu li').click(function () {
            var selectedValue = $(this).attr('value');
            $('#destination').text(selectedValue);
            $('#elegibleLoanAmount').text('₹ 0');
        });
    });

    function pl_elgigibility_cal() {
        var tenure = parseInt($('#tenure').val());
        var interest = parseFloat($('#interestRate').val());
        var principal = parseFloat($("#loanAmount").val());

        // EMI Formula
        let monthlyRate = interest / (12 * 100);
        let emi = principal * monthlyRate * Math.pow(1 + monthlyRate, tenure) /
            (Math.pow(1 + monthlyRate, tenure) - 1);

        if (isFinite(emi)) {
            $('#elegibleLoanAmount').text('₹ ' + emi.toFixed(0).toLocaleString('en-IN'));
        } else {
            $('#elegibleLoanAmount').text('₹ 0');
        }
    }
</script>
